#!/bin/bash
# Enhanced build script that includes post-build fixes
echo "ğŸ”§ Enhanced Build Process for Replit Deployment"
echo "==============================================="

# Run the original build command
echo "ğŸ“¦ Running vite build..."
npx vite build

if [ $? -ne 0 ]; then
  echo "âŒ Vite build failed!"
  exit 1
fi

echo "ğŸ“¦ Running esbuild..."
npx esbuild server/index.ts --platform=node --packages=external --bundle --format=esm --outdir=dist

if [ $? -ne 0 ]; then
  echo "âŒ Esbuild failed!"
  exit 1
fi

echo "ğŸ”§ Running post-build fix..."
node postbuild.js

if [ $? -ne 0 ]; then
  echo "âŒ Post-build fix failed!"
  exit 1
fi

echo "âœ… Enhanced build completed successfully!"
echo "ğŸš€ Ready for deployment!"