<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1" />
    <script>
      // Fix Vite WebSocket connection BEFORE any modules load
      if (window.location.hostname.includes('replit.dev')) {
        const originalWebSocket = window.WebSocket;
        window.WebSocket = function(url, protocols) {
          let fixedUrl = url.toString();
          
          // Fix Vite HMR WebSocket URL for Replit
          if (fixedUrl.includes('localhost:5173') || fixedUrl.includes('localhost')) {
            const urlObj = new URL(fixedUrl);
            const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
            // Preserve query parameters (especially the token)
            fixedUrl = `${protocol}//${window.location.host}${urlObj.pathname}${urlObj.search}`;
            console.log('ðŸ”§ WebSocket redirect:', url, 'â†’', fixedUrl);
          }
          
          return new originalWebSocket(fixedUrl, protocols);
        };
        
        // Copy static properties to maintain compatibility
        Object.setPrototypeOf(window.WebSocket, originalWebSocket);
        Object.defineProperty(window.WebSocket, 'prototype', { 
          value: originalWebSocket.prototype 
        });
      }
    </script>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
    <!-- This is a replit script which adds a banner on the top of the page when opened in development mode outside the replit environment -->
    <script type="text/javascript" src="https://replit.com/public/js/replit-dev-banner.js"></script>
  </body>
</html>